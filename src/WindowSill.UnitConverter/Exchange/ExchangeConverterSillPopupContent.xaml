<?xml version="1.0" encoding="utf-8"?>
<api:SillPopupContent
    x:Class="WindowSill.UnitConverter.Exchange.ExchangeConverterSillPopupContent"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:api="using:WindowSill.API"
    xmlns:converters="using:CommunityToolkit.WinUI.Converters"
    xmlns:local="using:WindowSill.UnitConverter.Exchange"
    mc:Ignorable="d"
    Width="360"
    Height="420"
    Opening="SillPopupContent_Opening">
    <api:SillPopupContent.Resources>
        <ResourceDictionary>
            <converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
            <converters:BoolToVisibilityConverter x:Key="InverseBoolToVisibilityConverter" FalseValue="Visible" TrueValue="Collapsed"/>
        </ResourceDictionary>
    </api:SillPopupContent.Resources>

    <Grid>
        <!-- Loading State -->
        <StackPanel
            HorizontalAlignment="Center"
            VerticalAlignment="Center"
            Spacing="16"
            Visibility="{x:Bind ViewModel.IsLoading, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}">
            <ProgressRing
                IsActive="{x:Bind ViewModel.IsLoading, Mode=OneWay}"
                Width="32"
                Height="32"/>
            <TextBlock
                api:Uids.Uid="/WindowSill.UnitConverter/Exchange/Loading"
                Style="{StaticResource CaptionTextBlockStyle}"
                HorizontalAlignment="Center"
                Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
        </StackPanel>

        <!-- Currency List -->
        <Grid
            Visibility="{x:Bind ViewModel.IsLoading, Mode=OneWay, Converter={StaticResource InverseBoolToVisibilityConverter}}">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            <AutoSuggestBox
                x:Name="SearchBox"
                api:Uids.Uid="/WindowSill.UnitConverter/Exchange/Search"
                Grid.Row="0"
                Margin="12"
                HorizontalAlignment="Stretch"
                KeyboardAcceleratorPlacementMode="Hidden"
                QueryIcon="Find"
                Text="{x:Bind ViewModel.SearchQuery, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                <AutoSuggestBox.KeyboardAccelerators>
                    <KeyboardAccelerator
                        Key="F"
                        Modifiers="Control"
                        Invoked="SearchBoxFocusShortcut_Invoked"/>
                </AutoSuggestBox.KeyboardAccelerators>
            </AutoSuggestBox>
            <ListView
                Grid.Row="1"
                ItemsSource="{x:Bind ExchangeRatesCollectionViewSource.View, Mode=OneWay}"
                HorizontalAlignment="Stretch"
                SelectionMode="None"
                IsItemClickEnabled="True">
                <CollectionViewSource
                    x:Name="ExchangeRatesCollectionViewSource"
                    Source="{x:Bind ViewModel.FilteredExchangeRates, Mode=OneWay}"
                    IsSourceGrouped="False"/>
                <ListView.ItemContainerTransitions>
                    <TransitionCollection>
                        <AddDeleteThemeTransition />
                        <RepositionThemeTransition />
                    </TransitionCollection>
                </ListView.ItemContainerTransitions>
                <ListView.ItemTemplate>
                    <DataTemplate x:DataType="local:CurrencyValue">
                        <Grid
                            Padding="8"
                            ColumnSpacing="12"
                            Background="Transparent"
                            Tapped="ItemTapped">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock
                                Grid.Column="0"
                                Text="{x:Bind Currency}"
                                TextTrimming="CharacterEllipsis"/>

                            <StackPanel
                                Grid.Column="1"
                                Orientation="Horizontal"
                                Spacing="8"
                                VerticalAlignment="Center">
                                <TextBlock
                                    Text="{x:Bind FormattedValue}"
                                    Style="{StaticResource CaptionTextBlockStyle}"
                                    Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                    VerticalAlignment="Center"/>
                                <FontIcon
                                    Glyph="&#xE8C8;"
                                    FontSize="14"
                                    VerticalAlignment="Center"/>
                            </StackPanel>
                        </Grid>
                    </DataTemplate>
                </ListView.ItemTemplate>
            </ListView>
        </Grid>
    </Grid>
</api:SillPopupContent>